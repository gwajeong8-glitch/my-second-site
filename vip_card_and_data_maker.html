<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VIP 카드 제작기 & 데이터 제작기</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f0f10;
      --panel:#0b0b0b;
      --gold1:#c79a4a;
      --gold2:#f1d38a;
      --muted:#bdb7b0;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#050505 0%, #111 100%);color:#fff;min-height:100vh}
    .wrap{max-width:1200px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center}
    header h1{font-family:'Playfair Display';font-size:22px;margin:0;color:var(--gold2)}
    .tabs{display:flex;gap:8px;margin-top:18px}
    .tab{padding:10px 16px;background:rgba(255,255,255,0.02);border-radius:10px;cursor:pointer}
    .tab.active{background:linear-gradient(90deg, rgba(199,154,74,0.18), rgba(241,211,138,0.06));border:1px solid rgba(199,154,74,0.25)}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:18px;margin-top:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text], input[type=number], select, textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .small{width:120px}
    .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;background:var(--gold1);color:#081; font-weight:600}
    .muted{color:var(--muted);font-size:13px}

    /* preview */
    .preview-wrap{display:flex;flex-direction:column;gap:10px;align-items:center}
    #previewCanvas{width:360px;height:220px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.6);background:#222}
    .bg-thumb{display:flex;gap:8px;flex-wrap:wrap}
    .bg-thumb img{width:72px;height:48px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid transparent}
    .bg-thumb img.sel{border-color:var(--gold1)}

    /* data maker */
    .table-editor{max-height:220px;overflow:auto;border-radius:8px;border:1px dashed rgba(255,255,255,0.04);padding:8px}
    table{width:100%;border-collapse:collapse}
    td, th{padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:13px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}

    footer{margin-top:18px;color:var(--muted);font-size:13px}

    @media(max-width:920px){.grid{grid-template-columns:1fr} #previewCanvas{width:320px;height:200px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Noblesse — 제작 도구</h1>
      <div class="muted">메뉴 1: VIP 카드 제작기 · 메뉴 2: 데이터 제작기</div>
    </header>

    <div class="tabs" role="tablist">
      <div class="tab active" data-tab="card">메뉴 1 — VIP 카드 제작기</div>
      <div class="tab" data-tab="data">메뉴 2 — 데이터 제작기</div>
    </div>

    <div class="grid">
      <!-- left: forms -->
      <div>
        <div class="card" id="cardPanel">
          <h3 style="margin-top:0">VIP 카드 제작기</h3>
          <div class="muted">왼쪽에 있는 배경(원 이미지)을 선택하고 우측 미리보기를 확인해 주세요.</div>

          <div style="margin-top:12px">
            <label>이름 (ID로 표기)</label>
            <input id="inpName" type="text" placeholder="예) 아가리" value="아가리">
          </div>

          <div style="margin-top:10px">
            <label>카드 번호</label>
            <input id="inpCardNo" type="text" placeholder="예) 1561654132" value="1561654132">
          </div>

          <div class="row" style="margin-top:10px">
            <div>
              <label>VIP 레벨</label>
              <select id="inpLevel"><option>VIP1</option><option>VIP2</option><option selected>VIP3</option></select>
            </div>
            <div>
              <label>폰트 크기 (제목)</label>
              <input id="inpFontSize" type="number" value="28">
            </div>
          </div>

          <div style="margin-top:10px">
            <label>원본 배경 선택 (이미지는 /img/ 폴더에 두세요)</label>
            <div class="bg-thumb" id="bgList">
              <img src="/img/vip1.png" data-src="/img/vip1.png" alt="vip1">
              <img src="/img/vip2.png" data-src="/img/vip2.png" alt="vip2">
              <img src="/img/vip3.png" data-src="/img/vip3.png" alt="vip3" class="sel">
              <img src="/bak.png" data-src="/bak.png" alt="bak">
            </div>
            <div class="muted" style="margin-top:8px">※ 경로가 다르면 이미지가 안 뜹니다. card.html과 같은 폴더 구조를 유지하세요. (참고: 당신이 말한대로 bak.png는 최상위에 있을 수 있습니다.)</div>
          </div>

          <div style="margin-top:12px" class="controls">
            <button class="btn" id="btnRender">미리보기 반영</button>
            <button class="btn" id="btnDownload">PNG로 저장</button>
            <button class="btn" id="btnReset">초기화</button>
          </div>
        </div>

        <div class="card" id="dataPanel" style="margin-top:18px;display:none">
          <h3 style="margin-top:0">데이터 제작기</h3>
          <div class="muted">기본 문구와 표를 만들어서 미리보기·CSV·JSON 추출 가능</div>

          <div style="margin-top:10px">
            <label>상단 문구 (예: ID: 아가리)</label>
            <input id="dataHeader" type="text" placeholder="ID: 아가리" value="ID: 아가리">
          </div>

          <div style="margin-top:10px">
            <label>설명/하단 문구</label>
            <textarea id="dataNote" rows="3">CARD NO: 1561654132</textarea>
          </div>

          <div style="margin-top:10px">
            <label>표 편집</label>
            <div class="table-editor" id="tableEditor">
              <table id="dataTable">
                <thead><tr><th>Key</th><th>Value</th><th></th></tr></thead>
                <tbody>
                  <tr><td><input value="성별"></td><td><input value="여"></td><td><button class="btn rm">삭제</button></td></tr>
                  <tr><td><input value="나이"></td><td><input value="26"></td><td><button class="btn rm">삭제</button></td></tr>
                </tbody>
              </table>
            </div>
            <div style="margin-top:8px" class="controls">
              <button class="btn" id="addRow">행 추가</button>
              <button class="btn" id="btnPreviewData">데이터 미리보기 반영</button>
              <button class="btn" id="exportCSV">CSV로 저장</button>
              <button class="btn" id="exportJSON">JSON으로 저장</button>
            </div>
          </div>
        </div>
      </div>

      <!-- right: preview -->
      <div>
        <div class="card preview-wrap">
          <div style="display:flex;justify-content:space-between;width:100%;align-items:center">
            <div style="font-weight:600">미리보기</div>
            <div class="muted">실제 출력 비율: 3.6 x 2.2 (inch 비율)</div>
          </div>

          <canvas id="previewCanvas" width="720" height="440"></canvas>

          <div style="width:100%;display:flex;justify-content:space-between;align-items:center">
            <div class="muted">다운로드된 이미지는 고해상도(2배) PNG입니다.</div>
            <div>
              <button class="btn" id="btnPrint">프린트</button>
            </div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <h4 style="margin:8px 0">사용법</h4>
          <ol class="muted">
            <li>이미지는 <code>/img/</code> 폴더에 넣으세요 (vip1.png, vip2.png, vip3.png 등). bak.png는 필요하면 상위 폴더에 둬도 됩니다. 경로가 다르면 코드 내 src 경로를 수정하세요.</li>
            <li>왼쪽에서 텍스트·배경을 선택하고 <b>미리보기 반영</b>을 누르세요.</li>
            <li>원한다면 <b>PNG로 저장</b> 해 출력하거나 트윗/메시지용으로 사용하세요.</li>
            <li>데이터 제작기는 표를 편집 후 CSV/JSON으로 내려받을 수 있습니다.</li>
          </ol>
        </div>
      </div>
    </div>

    <footer>문의/추가 디자인 수정 원하면 알려줘 — 바로 반영해서 더 세밀하게 맞춰줄게.</footer>

  </div>

  <script>
    // --- util: DOM ---
    const $ = q => document.querySelector(q);
    const $$ = q => Array.from(document.querySelectorAll(q));

    // Tabs
    $$('.tab').forEach(t => t.addEventListener('click', (e)=>{
      $$('.tab').forEach(x=>x.classList.remove('active'));
      e.currentTarget.classList.add('active');
      const tab = e.currentTarget.dataset.tab;
      document.getElementById('cardPanel').style.display = tab==='card' ? '' : 'none';
      document.getElementById('dataPanel').style.display = tab==='data' ? '' : 'none';
    }));

    // backgrounds
    const bgImgs = $$('#bgList img');
    let selectedBg = bgImgs.find(i=>i.classList.contains('sel'))?.dataset.src || bgImgs[0].dataset.src;
    bgImgs.forEach(img=>img.addEventListener('click', ()=>{
      bgImgs.forEach(x=>x.classList.remove('sel'));
      img.classList.add('sel');
      selectedBg = img.dataset.src;
    }));

    // canvas preview
    const canvas = $('#previewCanvas');
    const ctx = canvas.getContext('2d');
    const DPR = 2; // high-res export
    canvas.width = 360 * DPR; canvas.height = 220 * DPR; // internal px
    canvas.style.width = '360px'; canvas.style.height = '220px';

    function drawPreview(){
      const name = $('#inpName').value || '';
      const cardNo = $('#inpCardNo').value || '';
      const level = $('#inpLevel').value || 'VIP3';
      const fontSize = Number($('#inpFontSize').value) || 28;

      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.src = selectedBg;
      img.onload = ()=>{
        // draw background cover
        ctx.clearRect(0,0,canvas.width,canvas.height);
        // fill black base
        ctx.fillStyle = '#0b0b0b'; ctx.fillRect(0,0,canvas.width,canvas.height);
        // draw background with cover sizing
        const sw = img.width, sh = img.height, dw = canvas.width, dh = canvas.height;
        const sr = sw/sh, dr = dw/dh;
        let dwDraw = dw, dhDraw = dh, sx=0, sy=0, sWidth=sw, sHeight=sh;
        if(sr > dr){ // image wider
          sWidth = Math.round(sh * dr);
          sx = Math.round((sw - sWidth)/2);
        } else {
          sHeight = Math.round(sw / dr);
          sy = Math.round((sh - sHeight)/2);
        }
        ctx.drawImage(img, sx, sy, sWidth, sHeight, 0, 0, dwDraw, dhDraw);

        // overlay slight vignette
        const g = ctx.createLinearGradient(0,0,0,canvas.height);
        g.addColorStop(0,'rgba(0,0,0,0.12)'); g.addColorStop(1,'rgba(0,0,0,0.22)');
        ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);

        // logo heart (simple gold circle + letter) - left center
        const logoX = canvas.width*0.62, logoY = canvas.height*0.35;
        ctx.save();
        ctx.beginPath(); ctx.fillStyle = '#d4b26b'; ctx.arc(logoX, logoY, 46, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = '#fff'; ctx.font = `${24*DPR}px Playfair Display, serif`; ctx.textAlign='center'; ctx.textBaseline='middle';
        ctx.fillStyle = '#0b0b0b'; ctx.fillText('N', logoX, logoY-2);
        ctx.restore();

        // Title: NOBLESSE
        ctx.fillStyle = '#e9d09a'; ctx.font = `${22*DPR}px Playfair Display, serif`;
        ctx.textAlign = 'center'; ctx.fillText('NOBLESSE', canvas.width*0.62, canvas.height*0.54);

        // VIP text
        ctx.fillStyle = '#f0c97a'; ctx.font = `${18*DPR}px Inter, sans-serif`;
        ctx.textAlign = 'right'; ctx.fillText(level, canvas.width*0.95, canvas.height*0.8);

        // name at left
        ctx.fillStyle = '#fff'; ctx.font = `${fontSize*DPR}px Playfair Display, serif`;
        ctx.textAlign = 'left'; ctx.fillText(name, canvas.width*0.06, canvas.height*0.75);

        // card no bottom left small
        ctx.fillStyle = 'rgba(255,255,255,0.9)'; ctx.font = `${12*DPR}px Inter, sans-serif`;
        ctx.fillText(cardNo ? 'CARD NO: '+cardNo : '', canvas.width*0.06, canvas.height*0.88);
      };
      img.onerror = ()=>{
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = '#111'; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle = '#fff'; ctx.font = `${20*DPR}px Inter, sans-serif`;
        ctx.textAlign='center'; ctx.fillText('이미지를 불러올 수 없습니다. 경로를 확인하세요.', canvas.width/2, canvas.height/2);
      }
    }

    // initial draw
    drawPreview();
    $('#btnRender').addEventListener('click', ()=>{ drawPreview(); });

    // download PNG
    $('#btnDownload').addEventListener('click', ()=>{
      // ensure latest
      drawPreview();
      setTimeout(()=>{
        const link = document.createElement('a');
        link.download = `vip_card_${Date.now()}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
      }, 120);
    });

    $('#btnPrint').addEventListener('click', ()=>{ window.print(); });
    $('#btnReset').addEventListener('click', ()=>{ $('#inpName').value='아가리'; $('#inpCardNo').value='1561654132'; $('#inpLevel').value='VIP3'; drawPreview(); });

    // data table editor
    function rebuildTableData(){
      const rows = Array.from(document.querySelectorAll('#dataTable tbody tr'));
      return rows.map(r=>{
        const k = r.querySelector('td:nth-child(1) input').value;
        const v = r.querySelector('td:nth-child(2) input').value;
        return {k,v};
      });
    }
    document.getElementById('addRow').addEventListener('click', ()=>{
      const tbody = document.querySelector('#dataTable tbody');
      const tr = document.createElement('tr');
      tr.innerHTML = `<td><input value=""></td><td><input value=""></td><td><button class="btn rm">삭제</button></td>`;
      tbody.appendChild(tr);
      tr.querySelector('.rm').addEventListener('click', ()=>tr.remove());
    });
    $$('.rm').forEach(b=>b.addEventListener('click', e=>e.currentTarget.closest('tr').remove()));

    document.getElementById('btnPreviewData').addEventListener('click', ()=>{
      // reflect data text into canvas bottom-left
      const header = $('#dataHeader').value;
      const note = $('#dataNote').value;
      const table = rebuildTableData();
      // draw small overlay on canvas
      ctx.save();
      ctx.fillStyle='rgba(0,0,0,0.42)'; ctx.fillRect(canvas.width*0.04, canvas.height*0.04, canvas.width*0.52, canvas.height*0.28);
      ctx.fillStyle='#fff'; ctx.font = `${12*DPR}px Inter, sans-serif`;
      ctx.textAlign='left';
      ctx.fillText(header, canvas.width*0.06, canvas.height*0.09);
      ctx.fillText(note, canvas.width*0.06, canvas.height*0.15);
      table.forEach((r,i)=>{ ctx.fillText(r.k+': '+r.v, canvas.width*0.06, canvas.height*(0.195 + i*0.045)); });
      ctx.restore();
    });

    // export CSV/JSON
    function csvEncode(rows){
      const esc = s => '"'+String(s).replace(/"/g,'""')+'"';
      return rows.map(r=>[esc(r.k),esc(r.v)].join(',')).join('\n');
    }
    document.getElementById('exportCSV').addEventListener('click', ()=>{
      const rows = rebuildTableData();
      const csv = 'Key,Value\n' + rows.map(r=>`${JSON.stringify(r.k)},${JSON.stringify(r.v)}`).join('\n');
      const blob = new Blob([csv],{type:'text/csv'});
      const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='data_table.csv'; a.click(); URL.revokeObjectURL(url);
    });
    document.getElementById('exportJSON').addEventListener('click', ()=>{
      const rows = rebuildTableData();
      const obj = {}; rows.forEach(r=>obj[r.k]=r.v);
      const blob = new Blob([JSON.stringify(obj,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='data_table.json'; a.click(); URL.revokeObjectURL(url);
    });

    // accessibility: enter to render
    [$('#inpName'), $('#inpCardNo'), $('#inpFontSize')].forEach(el=>el.addEventListener('keydown', e=>{ if(e.key==='Enter') drawPreview(); }));

    // note about paths: if your bak.png is outside, change the src in DOM or move file.
  </script>
</body>
</html>
